#!/bin/bash
# RPM pre-uninstall script for ddogreen

# RPM preun script - $1 = 0 for uninstall, $1 = 1 for upgrade
if [ "$1" = "0" ]; then
    # Complete removal
    echo "Stopping and removing ddogreen service..."
    
    # Use the application's built-in service uninstallation
    if /usr/bin/ddogreen --uninstall; then
        echo "ddogreen service has been stopped and removed successfully."
    else
        echo "Warning: Failed to uninstall ddogreen service automatically."
        echo "Attempting manual cleanup..."
        # Fallback to manual cleanup
        systemctl stop ddogreen.service || true
        systemctl disable ddogreen.service || true
    fi
elif [ "$1" = "1" ]; then
    # Upgrade - don't remove service, just stop it temporarily
    echo "Stopping ddogreen service for upgrade..."
    systemctl stop ddogreen.service || true
fi

exit 0
