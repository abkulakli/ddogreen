#!/bin/bash
# Post-installation script for ddogreen (DEB)

set -e

case "$1" in
    configure)
        echo "Setting up ddogreen..."
        
        # Ensure configuration directory exists
        mkdir -p /etc/ddogreen
        
        # Install default configuration if it doesn't exist
        if [ ! -f /etc/ddogreen/ddogreen.conf ]; then
            if [ -f /usr/share/ddogreen/ddogreen.conf.default ]; then
                cp /usr/share/ddogreen/ddogreen.conf.default /etc/ddogreen/ddogreen.conf
                chmod 644 /etc/ddogreen/ddogreen.conf
                echo "Default configuration installed at /etc/ddogreen/ddogreen.conf"
            fi
        else
            echo "Existing configuration preserved at /etc/ddogreen/ddogreen.conf"
        fi
        
        # Use the application's built-in service installation
        if /usr/local/bin/ddogreen --install; then
            echo "ddogreen service has been installed and started successfully!"
            echo "The service will automatically start on boot."
            echo ""
            echo "Service management:"
            echo "  Status:  sudo systemctl status ddogreen"
            echo "  Stop:    sudo systemctl stop ddogreen"
            echo "  Start:   sudo systemctl start ddogreen"
            echo "  Restart: sudo systemctl restart ddogreen"
            echo "  Logs:    sudo journalctl -u ddogreen -f"
        else
            echo "Warning: Failed to install ddogreen service automatically."
            echo "You can manually install it with: sudo ddogreen --install"
        fi
        ;;
esac

exit 0
